<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WarpAI ‚Äì Onchain Activity</title>

  <!-- Wallet Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/viem@1.14.2/dist/viem.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/wagmi@1.3.6/dist/wagmi.umd.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/modal@2.6.4/dist/index.umd.js"></script>

  <style>
    :root {
      --accent: #6366f1;
      --bg: #0d0d0d;
      --card: #1a1a1a;
      --text: #e5e5e5;
      --muted: #888;
      --success: #10b981;
      --warning: #f59e0b;
    }

    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: system-ui, sans-serif;
      max-width: 480px;
      margin: 0 auto;
      padding: 1rem;
    }

    .brand {
      color: var(--accent);
      font-weight: bold;
      font-size: 1.6rem;
      text-align: center;
    }

    .desc {
      text-align: center;
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 1rem;
    }

    .card-grid {
      display: flex;
      gap: 0.5rem;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 0.8rem;
      flex: 1;
      text-align: center;
      font-size: 0.9rem;
    }

    .emoji {
      font-size: 1.4rem;
    }

    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      font-size: 0.9rem;
      border-radius: 8px;
      margin: 0.4rem 0;
      cursor: pointer;
    }

    #disconnectWallet {
      background: #e53935;
      display: none;
    }

    #headerWalletAddress {
      font-size: 0.85rem;
      color: #aaa;
      text-align: center;
      margin-top: 0.6rem;
    }

    footer {
      text-align: center;
      font-size: 0.75rem;
      color: #777;
      margin-top: 1.5rem;
    }
  </style>
</head>
<body>
  <div class="brand">WarpAI</div>
  <p class="desc">Mini Wallet App ‚Äì Warpcast Ready</p>

  <div class="card-grid">
    <div class="card">
      <div class="emoji">üëõ</div>
      <strong>Wallet</strong>
      <button id="connectWallet">Connect Wallet</button>
      <button id="disconnectWallet">Disconnect</button>
      <div id="headerWalletAddress">Not Connected</div>
    </div>
    <div class="card">
      <div class="emoji">üìà</div>
      <strong>Claim</strong>
      <div style="margin-top: 4px;">Coming Soon</div>
    </div>
    <div class="card">
      <div class="emoji">üìç</div>
      <strong>Track</strong>
      <div style="margin-top: 4px;">Coming Soon</div>
    </div>
  </div>

  <footer>WarpAI v1 ‚Äì wagmi@1.3.6 / viem@1.14.2</footer>

  <script>
    let config;
    let client;
    const WALLETCONNECT_PROJECT_ID = 'c0aa1ca206eb7d58226102b102ec49e9';

    const base = {
      id: 8453,
      name: 'Base',
      network: 'base',
      nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
      rpcUrls: { default: { http: ['https://mainnet.base.org'] }, public: { http: ['https://mainnet.base.org'] } },
      blockExplorers: { default: { name: 'Basescan', url: 'https://basescan.org' } },
      contracts: {
        multicall3: {
          address: '0xcA11bde05977b3631167028862bE2a173976CA11',
          blockCreated: 8440150,
        },
      },
    };

    const walletConnectConnector = typeof wagmi !== 'undefined' && typeof wagmi.connectors !== 'undefined'
      ? new wagmi.connectors.WalletConnectConnector({
          chains: [base],
          options: { projectId: WALLETCONNECT_PROJECT_ID, showQrModal: true },
        }) : null;

    function initializeWagmi() {
      if (
        typeof wagmi === 'undefined' ||
        typeof wagmi.createClient !== 'function' ||
        typeof viem === 'undefined' ||
        typeof viem.createPublicClient !== 'function'
      ) {
        console.error("Libraries not loaded");
        return;
      }

      config = wagmi.createClient({
        autoConnect: true,
        connectors: [walletConnectConnector, new wagmi.connectors.InjectedConnector({ chains: [base] })].filter(Boolean),
        provider: ({ chainId }) => viem.createPublicClient({ chain: base, transport: viem.http() }),
      });

      client = config;

      config.subscribe((state) => {
        const isConnected = state.status === 'connected';
        const address = state.data?.account;
        document.getElementById('connectWallet').style.display = isConnected ? 'none' : 'inline-block';
        document.getElementById('disconnectWallet').style.display = isConnected ? 'inline-block' : 'none';
        document.getElementById('headerWalletAddress').textContent = address || 'Not Connected';
      });
    }

    function waitForWagmiAndViem(retry = 0) {
      if (
        typeof wagmi !== 'undefined' &&
        typeof wagmi.createClient === 'function' &&
        typeof viem !== 'undefined' &&
        typeof viem.createPublicClient === 'function'
      ) {
        initializeWagmi();
      } else if (retry < 10) {
        console.log("Waiting for wagmi and viem...");
        setTimeout(() => waitForWagmiAndViem(retry + 1), 300);
      } else {
        console.error("Timeout loading libraries");
      }
    }
    waitForWagmiAndViem();

    async function connectWallet() {
      if (!config) return;
      try {
        const { connector } = await config.connect({ connector: walletConnectConnector });
        const state = config.getState?.();
        console.log("Connected:", state?.data?.account);
      } catch (e) {
        console.error("Connect failed", e);
      }
    }

    async function disconnectWallet() {
      if (!config) return;
      try {
        await config.disconnect();
        document.getElementById('headerWalletAddress').textContent = 'Not Connected';
        localStorage.clear();
      } catch (e) {
        console.error("Disconnect failed", e);
      }
    }

    document.getElementById('connectWallet')?.addEventListener('click', connectWallet);
    document.getElementById('disconnectWallet')?.addEventListener('click', disconnectWallet);
  </script>
</body>
</html>